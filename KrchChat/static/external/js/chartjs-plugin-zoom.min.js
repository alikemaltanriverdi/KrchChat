!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o(require("chart.js"),require("hammerjs")):"function"==typeof define&&define.amd?define(["chart.js","hammerjs"],o):(e=e||self).ChartZoom=o(e.Chart,e.Hammer)}(this,function(e,i){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;var f=e.helpers,v=e.Zoom=e.Zoom||{},m=v.zoomFunctions=v.zoomFunctions||{},a=v.panFunctions=v.panFunctions||{};function l(e,o){var t={},e=(void 0!==e.options.pan&&(t.pan=e.options.pan),void 0!==e.options.zoom&&(t.zoom=e.options.zoom),e.$zoom),t=(o=e._options=f.merge({},[o,t]),e._node),n=o.zoom&&o.zoom.enabled,o=o.zoom.drag;n&&!o?t.addEventListener("wheel",e._wheelHandler):t.removeEventListener("wheel",e._wheelHandler),n&&o?(t.addEventListener("mousedown",e._mouseDownHandler),t.ownerDocument.addEventListener("mouseup",e._mouseUpHandler)):(t.removeEventListener("mousedown",e._mouseDownHandler),t.removeEventListener("mousemove",e._mouseMoveHandler),t.ownerDocument.removeEventListener("mouseup",e._mouseUpHandler))}function h(t){var n=t.$zoom._originalOptions;f.each(t.scales,function(e){n[e.id]||(n[e.id]=f.clone(e.options))}),f.each(n,function(e,o){t.scales[o]||delete n[o]})}function x(e,o,t){return void 0===e||("string"==typeof e?-1!==e.indexOf(o):"function"==typeof e&&-1!==e({chart:t}).indexOf(o))}function c(e,o){return o=e.scaleAxes&&e.rangeMax&&!f.isNullOrUndef(e.rangeMax[e.scaleAxes])&&(e=e.rangeMax[e.scaleAxes])<o?e:o}function u(e,o){return o=e.scaleAxes&&e.rangeMin&&!f.isNullOrUndef(e.rangeMin[e.scaleAxes])&&o<(e=e.rangeMin[e.scaleAxes])?e:o}function r(e,o,t,n){var a=e.max-e.min,o=a*(o-1),t=e.isHorizontal()?t.x:t.y,t=(e.getValueForPixel(t)-e.min)/a,a=o*(1-t);e.options.ticks.min=u(n,e.min+o*t),e.options.ticks.max=c(n,e.max-a)}function d(e,o,t,n){var a=m[e.type];a&&a(e,o,t,n)}function g(o,t,n,a,e,i){var m,l,r=o.chartArea,s=(a=a||{x:(r.left+r.right)/2,y:(r.top+r.bottom)/2},o.$zoom._options.zoom);s.enabled&&(h(o),m="function"==typeof s.mode?s.mode({chart:o}):s.mode,l="xy"===m&&void 0!==e?e:"xy",f.each(o.scales,function(e){e.isHorizontal()&&x(m,"x",o)&&x(l,"x",o)?(s.scaleAxes="x",d(e,t,a,s)):!e.isHorizontal()&&x(m,"y",o)&&x(l,"y",o)&&(s.scaleAxes="y",d(e,n,a,s))}),i?o.update({duration:i,easing:"easeOutQuad"}):o.update(0),"function"==typeof s.onZoom)&&s.onZoom({chart:o})}function n(e,o,t){var n,a=e.options.ticks,i=e.min,m=e.max,l=e.getValueForPixel(e.getPixelForValue(i)-o),e=e.getValueForPixel(e.getPixelForValue(m)-o),o=l=l.valueOf?l.valueOf():l,r=e=e.valueOf?e.valueOf():e;t.scaleAxes&&t.rangeMin&&!f.isNullOrUndef(t.rangeMin[t.scaleAxes])&&(o=t.rangeMin[t.scaleAxes]),t.scaleAxes&&t.rangeMax&&!f.isNullOrUndef(t.rangeMax[t.scaleAxes])&&(r=t.rangeMax[t.scaleAxes]),o<=l&&e<=r?(a.min=l,a.max=e):l<o?(n=i-o,a.min=o,a.max=m-n):r<e&&(n=r-m,a.max=r,a.min=i+n)}function z(e,o,t){var n=a[e.type];n&&n(e,o,t)}e.Zoom.defaults=e.defaults.global.plugins.zoom={pan:{enabled:!1,mode:"xy",speed:20,threshold:10},zoom:{enabled:!1,mode:"xy",sensitivity:3,speed:.1}},v.zoomFunctions.category=function(e,o,t,n){var a=e.chart.data.labels,i=e.minIndex,m=a.length-1,l=e.maxIndex,r=n.sensitivity,s=e.isHorizontal()?e.left+e.width/2:e.top+e.height/2,t=e.isHorizontal()?t.x:t.y;v.zoomCumulativeDelta=1<o?v.zoomCumulativeDelta+1:v.zoomCumulativeDelta-1,Math.abs(v.zoomCumulativeDelta)>r&&(v.zoomCumulativeDelta<0?(s<=t?i<=0?l=Math.min(m,l+1):i=Math.max(0,i-1):t<s&&(m<=l?i=Math.max(0,i-1):l=Math.min(m,l+1)),v.zoomCumulativeDelta=0):0<v.zoomCumulativeDelta&&(s<=t?i=i<l?Math.min(l,i+1):i:t<s&&(l=i<l?Math.max(i,l-1):l),v.zoomCumulativeDelta=0),e.options.ticks.min=u(n,a[i]),e.options.ticks.max=c(n,a[l]))},v.zoomFunctions.time=function(e,o,t,n){r(e,o,t,n);o=e.options;o.time&&(o.time.min&&(o.time.min=o.ticks.min),o.time.max)&&(o.time.max=o.ticks.max)},v.zoomFunctions.linear=r,v.zoomFunctions.logarithmic=r,v.panFunctions.category=function(e,o,t){var n=e.chart.data.labels,a=n.length-1,i=Math.max(e.ticks.length,1),m=t.speed,l=e.minIndex,m=Math.round(e.width/(i*m));v.panCumulativeDelta+=o,l=v.panCumulativeDelta>m?Math.max(0,l-1):v.panCumulativeDelta<-m?Math.min(a-i+1,l+1):l,v.panCumulativeDelta=l!==e.minIndex?0:v.panCumulativeDelta,o=Math.min(a,l+i-1),e.options.ticks.min=u(t,n[l]),e.options.ticks.max=c(t,n[o])},v.panFunctions.time=function(e,o,t){n(e,o,t);o=e.options;o.time&&(o.time.min&&(o.time.min=o.ticks.min),o.time.max)&&(o.time.max=o.ticks.max)},v.panFunctions.linear=n,v.panFunctions.logarithmic=n,v.panCumulativeDelta=0,v.zoomCumulativeDelta=0;var o={id:"zoom",afterInit:function(e){e.resetZoom=function(){h(e);var n=e.$zoom._originalOptions;f.each(e.scales,function(e){var o=e.options.time,t=e.options.ticks;n[e.id]?(o&&(o.min=n[e.id].time.min,o.max=n[e.id].time.max),t&&(t.min=n[e.id].ticks.min,t.max=n[e.id].ticks.max)):(o&&(delete o.min,delete o.max),t&&(delete t.min,delete t.max))}),e.update()}},beforeUpdate:function(e,o){l(e,o)},beforeInit:function(c,e){c.$zoom={_originalOptions:{}};var m,o,t,r,s,u,n,d=c.$zoom._node=c.ctx.canvas,p=(l(c,e),c.$zoom._options),e=p.pan&&p.pan.threshold,a=(c.$zoom._mouseDownHandler=function(e){d.addEventListener("mousemove",c.$zoom._mouseMoveHandler),c.$zoom._dragZoomStart=e},c.$zoom._mouseMoveHandler=function(e){c.$zoom._dragZoomStart&&(c.$zoom._dragZoomEnd=e,c.update(0))},c.$zoom._mouseUpHandler=function(e){var o,t,n,a,i,m,l,r,s;c.$zoom._dragZoomStart&&(d.removeEventListener("mousemove",c.$zoom._mouseMoveHandler),n=(a=c.$zoom._dragZoomStart).target.getBoundingClientRect().left,o=Math.min(a.clientX,e.clientX)-n,n=Math.max(a.clientX,e.clientX)-n,i=a.target.getBoundingClientRect().top,t=Math.min(a.clientY,e.clientY)-i,n=n-o,a=Math.max(a.clientY,e.clientY)-i-t,c.$zoom._dragZoomStart=null,c.$zoom._dragZoomEnd=null,n<=(e=p.zoom&&p.zoom.threshold||0)&&a<=e||(i=c.chartArea,e=c.$zoom._options.zoom,m=i.right-i.left,l=x(e.mode,"x",c)&&n?1+(m-n)/m:1,r=i.bottom-i.top,s=x(e.mode,"y",c),g(c,l,s&&a?1+(r-a)/r:1,{x:(o-i.left)/(1-n/m)+i.left,y:(t-i.top)/(1-a/r)+i.top},void 0,e.drag.animationDuration),"function"==typeof e.onZoomComplete&&e.onZoomComplete({chart:c})))},null);c.$zoom._wheelHandler=function(e){var o,t,n;e.cancelable&&e.preventDefault(),void 0!==e.deltaY&&(o=e.target.getBoundingClientRect(),o={x:e.clientX-o.left,y:e.clientY-o.top},n=(t=c.$zoom._options.zoom).speed,0<=e.deltaY&&(n=-n),g(c,1+n,1+n,o),clearTimeout(a),a=setTimeout(function(){"function"==typeof t.onZoomComplete&&t.onZoomComplete({chart:c})},250))},i&&((o=new i.Manager(d)).add(new i.Pinch),o.add(new i.Pan({threshold:e})),t=function(e){var o=1/m*e.scale,t=e.target.getBoundingClientRect(),t={x:e.center.x-t.left,y:e.center.y-t.top},n=Math.abs(e.pointers[0].clientX-e.pointers[1].clientX),a=Math.abs(e.pointers[0].clientY-e.pointers[1].clientY),i=n/a,o=(g(c,o,o,t,.3<i&&i<1.7?"xy":a<n?"x":"y"),c.$zoom._options.zoom);"function"==typeof o.onZoomComplete&&o.onZoomComplete({chart:c}),m=e.scale},o.on("pinchstart",function(){m=1}),o.on("pinch",t),o.on("pinchend",function(e){t(e),m=null,v.zoomCumulativeDelta=0}),s=r=null,u=!1,n=function(e){var o,t,n,a,i,m,l;null!==r&&null!==s&&(u=!0,o=e.deltaX-r,t=e.deltaY-s,r=e.deltaX,s=e.deltaY,a=o,i=t,h(n=c),(l=n.$zoom._options.pan).enabled)&&(m="function"==typeof l.mode?l.mode({chart:n}):l.mode,f.each(n.scales,function(e){e.isHorizontal()&&x(m,"x",n)&&0!=a?(l.scaleAxes="x",z(e,a,l)):!e.isHorizontal()&&x(m,"y",n)&&0!=i&&(l.scaleAxes="y",z(e,i,l))}),n.update(0),"function"==typeof l.onPan)&&l.onPan({chart:n})},o.on("panstart",function(e){s=r=0,n(e)}),o.on("panmove",n),o.on("panend",function(){s=r=null,v.panCumulativeDelta=0,setTimeout(function(){u=!1},500);var e=c.$zoom._options.pan;"function"==typeof e.onPanComplete&&e.onPanComplete({chart:c})}),c.$zoom._ghostClickHandler=function(e){u&&e.cancelable&&(e.stopImmediatePropagation(),e.preventDefault())},d.addEventListener("click",c.$zoom._ghostClickHandler),c._mc=o)},beforeDatasetsDraw:function(a){var e,o,t,n,i,m,l,r=a.ctx;a.$zoom._dragZoomEnd&&(o=function(){for(var e=a.scales,o=Object.keys(e),t=0;t<o.length;t++){var n=e[o[t]];if(n.isHorizontal())return n}}(),n=function(){for(var e=a.scales,o=Object.keys(e),t=0;t<o.length;t++){var n=e[o[t]];if(!n.isHorizontal())return n}}(),i=a.$zoom._dragZoomStart,m=a.$zoom._dragZoomEnd,e=o.left,o=o.right,t=n.top,n=n.bottom,x(a.$zoom._options.zoom.mode,"x",a)&&(l=i.target.getBoundingClientRect().left,e=Math.min(i.clientX,m.clientX)-l,o=Math.max(i.clientX,m.clientX)-l),x(a.$zoom._options.zoom.mode,"y",a)&&(l=i.target.getBoundingClientRect().top,t=Math.min(i.clientY,m.clientY)-l,n=Math.max(i.clientY,m.clientY)-l),i=o-e,m=n-t,l=a.$zoom._options.zoom.drag,r.save(),r.beginPath(),r.fillStyle=l.backgroundColor||"rgba(225,225,225,0.3)",r.fillRect(e,t,i,m),0<l.borderWidth&&(r.lineWidth=l.borderWidth,r.strokeStyle=l.borderColor||"rgba(225,225,225)",r.strokeRect(e,t,i,m)),r.restore())},destroy:function(e){var o,t;e.$zoom&&((t=(o=e.$zoom)._node).removeEventListener("mousedown",o._mouseDownHandler),t.removeEventListener("mousemove",o._mouseMoveHandler),t.ownerDocument.removeEventListener("mouseup",o._mouseUpHandler),t.removeEventListener("wheel",o._wheelHandler),t.removeEventListener("click",o._ghostClickHandler),delete e.$zoom,t=e._mc)&&(t.remove("pinchstart"),t.remove("pinch"),t.remove("pinchend"),t.remove("panstart"),t.remove("pan"),t.remove("panend"),t.destroy())}};return e.plugins.register(o),o});