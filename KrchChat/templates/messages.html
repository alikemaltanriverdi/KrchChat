{% load static %}
<!DOCTYPE html>
<html>
	<head>  
		<title>Chat</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
		<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script> -->
        <script src="{% static 'js/jquery.js' %}"></script>
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.js"></script>
        <link rel="stylesheet" href="{% static 'css/messages.css' %}">
        <link rel="stylesheet" href="{% static 'css/style.css' %}">
        <link rel="stylesheet" href="{% static 'css/custom.css' %}">
        <link rel="stylesheet" href="{% static 'css/font-icons.css' %}">

    </head>

	<body  class="stretched side-panel-left" style=" background-image: linear-gradient(#FFFFFF, aquamarine); ">
        {% if user.is_authenticated %}
        
        <input type="hidden" id="logged-in-user" value="{{ user.id }}">
        {% endif %}
        <div class="body-overlay"></div>
        <div id="side-panel" class="dark">

            <div id="side-panel-trigger-close" class="side-panel-trigger"><a href="#"><i class="bi-x-lg"></i></a></div>
    
            <div class="side-panel-wrap">
    
                <div class="widget">
    
                    <h4>Pages</h4>
                    {% if user.is_authenticated %}
                 
                    <h4>{{ user.username }}</h4>
                    {% endif %}
                    <nav class="nav-tree mb-0">
                        <ul>
                            <li><a href="#"><i class="bi-lightning-fill"></i>Features</a>
                                <ul>
                                    <li><a href="#">Sliders</a></li>
                                    <li><a href="#">Widgets</a></li>
                                    <li><a href="#">Events</a></li>
                                    <li><a href="#">Headers</a></li>
                                </ul>
                            </li>
                            <li><a href="#"><i class="bi-card-image"></i>Portfolio</a>
                                <ul>
                                    <li><a href="#">Grid</a>
                                        <ul>
                                            <li><a href="#">3 Columns</a></li>
                                            <li><a href="#">4 Columns</a></li>
                                            <li><a href="#">5 Columns</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#">Masonry</a></li>
                                    <li><a href="#">Loading Styles</a></li>
                                    <li><a href="#">Single</a></li>
                                </ul>
                            </li>
                            <li><a href="#"><i class="bi-file-text"></i>About</a>
                                <ul>
                                    <li><a href="#">Company</a></li>
                                    <li><a href="#">Team</a></li>
                                    <li><a href="#">Services</a></li>
                                    <li><a href="#">FAQs</a></li>
                                </ul>
                            </li>
                            <li><a href="#"><i class="bi-geo-alt-fill"></i>Contact</a></li>
                        </ul>
                    </nav>
    
                </div>
    
                <div class="widget quick-contact-widget form-widget">
    
                    <h4>Quick Contact</h4>
                    <div class="form-result"></div>
                    <form id="quick-contact-form" name="quick-contact-form" action="include/form.php" method="post" class="quick-contact-form mb-0">
                        <div class="form-process">
                            <div class="css3-spinner">
                                <div class="css3-spinner-scaler"></div>
                            </div>
                        </div>
                        <input type="text" class="required form-control mb-2" id="quick-contact-form-name" name="quick-contact-form-name" value="" placeholder="Full Name">
                        <input type="text" class="required form-control email mb-2" id="quick-contact-form-email" name="quick-contact-form-email" value="" placeholder="Email Address">
                        <textarea class="required form-control mb-2 short-textarea" id="quick-contact-form-message" name="quick-contact-form-message" rows="4" cols="30" placeholder="Message"></textarea>
                        <input type="text" class="d-none" id="quick-contact-form-botcheck" name="quick-contact-form-botcheck" value="">
                        <input type="hidden" name="prefix" value="quick-contact-form-">
                        <button type="submit" id="quick-contact-form-submit" name="quick-contact-form-submit" class="button button-small button-3d m-0" value="submit">Send Email</button>
                    </form>
    
                </div>
    
            </div>
    
        </div>
     
        <!-- Header
		============================================= -->
		<header id="header" class="full-header ligth">
			<div id="header-wrap">
				<div class="container">
					<div class="header-row">

						<!-- Logo
						============================================= -->
						<div id="logo">
							<a href="#">
								<img class="logo-default side-panel-trigger" srcset="{% static 'assets/Krch-logos_black.png' %}" src="{% static 'assets/Krch-logos_black.png' %}" alt="Krch Logo">
								<img class="logo-dark side-panel-trigger" srcset="{% static 'assets/Krch-logos_black.png' %}" src="{% static 'assets/Krch-logos_black.png' %}" alt="Krch Logo">
							</a>
						</div><!-- #logo end -->

						<div class="header-misc">

							<!-- Top Search
							============================================= -->
							<!-- <div id="top-search" class="header-misc-icon">
								<a href="#" id="top-search-trigger"><i class="uil uil-search"></i><i class="bi-x-lg"></i></a>
							</div> -->
                            <!-- #top-search end -->

							<!-- Top Cart
							============================================= -->
							<div id="top-cart" class="header-misc-icon d-none d-sm-block">
                                
								<div id="top-cart-trigger">
                                   
                                    <div class="feature-box fbox-effect">
                                        <div class="fbox-icon">
                                            <a href="#"><i class="bi-person i-alt"></i></a>
                                        </div>
                                      
                                        
                                    </div>
                                </div>
								<div class="top-cart-content">
									<div class="top-cart-title">
										<h4>Account</h4>
                                        <span >
                                            <h3>{{ user.username }}</h3>
                                        </span>
									</div>
									<div class="top-cart-items">
										<div class="top-cart-item">
											<div class="top-cart-item-image">
												<div class="fbox-icon">
                                                    <a href="#"><i class="bi-person-fill-gear i-alt"></i></a>
                                                </div>
											</div>
											<div class="top-cart-item-desc">
												<div class="top-cart-item-desc-title">
													<a href="#">Go to Profile</a>
													<!-- <span class="top-cart-item-price d-block">$19.99</span> -->
												</div>
												<!-- <div class="top-cart-item-quantity">x 2</div> -->
											</div>
										</div>
										<div class="top-cart-item">
											<div class="top-cart-item-image">
												<div class="fbox-icon">
                                                    <a href="#"><i class="uil-setting i-alt"></i></a>
                                                </div>
											</div>
											<div class="top-cart-item-desc">
												<div class="top-cart-item-desc-title">
													<a href="#">Go to Settings</a>
													<!-- <span class="top-cart-item-price d-block">$24.99</span> -->
												</div>
												<!-- <div class="top-cart-item-quantity">x 3</div> -->
											</div>
										</div>
									</div>
									<div class="top-cart-action">
										<!-- <span class="top-checkout-price">$114.95</span> -->
										<div class="button button-3d button-red button-small m-0" id="log-out">Log Out</div>
									</div>
								</div>
							</div><!-- #top-cart end -->

						</div>

						<div class="primary-menu-trigger">
							<button class="cnvs-hamburger" type="button" title="Open Mobile Menu">
								<span class="cnvs-hamburger-box"><span class="cnvs-hamburger-inner"></span></span>
							</button>
						</div>

						<!-- Primary Navigation
						============================================= -->
						<nav class="primary-menu">

							<ul class="menu-container">
								<li class="menu-item">
									<a class="menu-link" href="index.html"><div>Home</div></a>
									<ul class="sub-menu-container">
										<li class="menu-item">
											<a class="menu-link" href="niche-demos.html"><div>Messages</div></a>
										</li>
									
										<li class="menu-item">
											<a class="menu-link" href="index-corporate.html"><div>Friends</div></a>
											<ul class="sub-menu-container">
                                                {% for friend in friends %}
												<li class="menu-item">
													<a class="menu-link" href="index-corporate.html"><div>{{ friend.username}}</div></a>
												</li>
                                                {% endfor %}
											
											</ul>
										</li>
										
									</ul>
								</li>
								
							</ul>

						</nav><!-- #primary-menu end -->

						<!-- <form class="top-search-form" action="search.html" method="get">
							<input type="text" name="q" class="form-control" value="" placeholder="Type &amp; Hit Enter.." autocomplete="off">
						</form> -->

					</div>
				</div>
			</div>
			<div class="header-wrap-clone"></div>
		</header><!-- #header end -->
        <!-- <a href="#" class="button button-xlarge button-rounded side-panel-trigger mb-5">Open Side Panel</a> -->
 
		<div class="container-fluid h-100" style=" background-image: linear-gradient(#FFFFFF, aquamarine); ">
			<div class="row justify-content-center h-100 ">
			<div class="col-md-2 col-xl-2 chat h-100 mt-2">
                    <div class="card mb-sm-3 mb-md-0 contacts_card">
					<div class="card-header">
						<h1>Friends</h1>
						<div class="input-group">
							<input type="text" placeholder="Search Friends..." name="" class="form-control search">
							<div class="input-group-prepend">
								<span class="input-group-text search_btn"><i class="fas fa-search"></i></span>
							</div>
						</div>
					</div>
					<div class="card-body contacts_body">
						<ui class="friends">
                            {% for friend in friends %}
                                <li class="{% if forloop.first %}active{% endif %} friend-li" friend-id="user_{{ friend.id }}" style="cursor: pointer">
                                    <div class="d-flex bd-highlight">
                                        <div class="img_cont">
                                            <img src="https://thumb.ac-illust.com/52/52681e2491ae435cfd5af91226c3c3cd_t.jpeg" class="rounded-circle user_img">
                                            <span class="online_icon"></span>
                                        </div>
                                        <div class="user_info">
											<span>{{ friend.username}}</span>
                                        </div>
                                    </div>
                                </li>
                            {% endfor %}
						</ui>
					</div>
					<div class="card-footer"></div>
				</div></div>
				<div class="col-md-2 col-xl-2 chat h-100 mt-2">
                    <div class="card mb-sm-3 mb-md-0 contacts_card">
					<div class="card-header">
						<h1>Chats</h1>
						<div class="input-group">
							<input type="text" placeholder="Search..." name="" class="form-control search">
							<div class="input-group-prepend">
								<span class="input-group-text search_btn"><i class="fas fa-search"></i></span>
							</div>
						</div>
					</div>
					<div class="card-body contacts_body">
						<ui class="contacts">
                            {% for conversation in conversations %}
                                <li class="{% if forloop.first %}active{% endif %} contact-li" chat-id="chat_{{ conversation.id }}" style="cursor: pointer">
                                    <div class="d-flex bd-highlight">
                                        <div class="img_cont">
                                            <img src="https://thumb.ac-illust.com/52/52681e2491ae435cfd5af91226c3c3cd_t.jpeg" class="rounded-circle user_img">
                                            <span class="online_icon"></span>
                                        </div>
                                        <div class="user_info">
                                            {% if conversation.first_person == user %}
                                                <span>{{ conversation.second_person.username }}</span>
                                            {% else %}
                                                <span>{{ conversation.first_person.username }}</span>
                                            {% endif %}

                                        </div>
                                    </div>
                                </li>
                            {% endfor %}
						</ui>
					</div>
					<div class="card-footer"></div>
				</div></div>
				<div class="col-md-8 col-xl-6 chat h-100 mt-4">
					<div class="card">
                        {% for conversation in conversations %}
                            <div class="messages-wrapper  {% if forloop.first %}hide is_active{% else %}hide{% endif %}" chat-id="chat_{{ conversation.id }}" other-user-id="
                                        {% if conversation.first_person == user %}
                                            {{ conversation.second_person.id }}
                                        {% else %}
                                            {{ conversation.first_person.id }}
                                        {% endif %}
                                    ">
                                <div class="card-header msg_head">
                                    <div class="d-flex bd-highlight">
                                        <div class="img_cont">
                                            <img src="https://thumb.ac-illust.com/52/52681e2491ae435cfd5af91226c3c3cd_t.jpeg" class="rounded-circle user_img">
                                            <span class="online_icon"></span>
                                        </div>
                                        <div class="user_info">
                                            {% if conversation.first_person == user %}
                                                    <span>Chat with {{ conversation.second_person.username }}</span>
                                            {% else %}
                                                <span>Chat with {{ conversation.first_person.username }}</span>
                                            {% endif %}
                                            <p>{{ conversation.chatmessage_conversation.all.count }} messages</p>
                                        </div>
                                    </div>
                                    <span id="action_menu_btn"><i class="fas fa-ellipsis-v"></i></span>
                                    <div class="action_menu">
                                        <ul>
                                            <li><i class="fas fa-user-circle"></i> View profile</li>
                                            <li><i class="fas fa-users"></i> Add to close friends</li>
                                            <li><i class="fas fa-plus"></i> Add to group</li>
                                            <li><i class="fas fa-ban"></i> Block</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="card-body msg_card_body">
                                    <!------- messages ------->
                                    {% for chat in conversation.chatmessage_conversation.all %}
                                        {% if chat.user == user %}
                                            <div class="d-flex mb-4 replied">
                                                <div class="msg_cotainer_send">
                                                    {{ chat.message }}
                                                    <span class="msg_time_send">{{ chat.timestamp|date:"d D" }}, {{ chat.timestamp|time:"H:i" }}</span>
                                                </div>
                                            <div class="img_cont_msg">
                                                <img src="https://thumb.ac-illust.com/52/52681e2491ae435cfd5af91226c3c3cd_t.jpeg" class="rounded-circle user_img_msg">
                                            </div>
                                        </div>
                                        {% else %}
                                            <div class="d-flex mb-4 received">
                                            <div class="img_cont_msg">
                                                <img src="https://thumb.ac-illust.com/52/52681e2491ae435cfd5af91226c3c3cd_t.jpeg" class="rounded-circle user_img_msg">
                                            </div>
                                            <div class="msg_cotainer">
                                                {{ chat.message }}
                                                <span class="msg_time">{{ chat.timestamp|date:"d D" }}, {{ chat.timestamp|time:"H:i" }}</span>
                                            </div>
                                        </div>
                                        {% endif %}
                                    {% endfor %}


                                    <!------- messages ------->
                                </div>

					        </div>
                        {% endfor %}
                        <div class=""></div>
                        <div class="card-footer">
                            <form id="send-message-form">
                                <div class="input-group">
                                    <div class="input-group-append">
                                        <span class="input-group-text attach_btn"><i class="fas fa-paperclip"></i></span>
                                    </div>
                                    <input type="text" name="" id="input-message" class="form-control type_msg" placeholder="Type your message...">
                                    <div class="input-group-append">
                                        <button class="btn btn-secondary" type="submit">
                                            <span class="input-group-text send_btn">
                                                <i class="fas fa-location-arrow"></i>
                                            </span>
                                        </button>
                                        <button class="btn btn-secondary" type="button" id="speech_to_text">
                                            <span class="input-group-text send_btn">
                                                <i class="fas fa-microphone" id="speech_text_icon"></i>
                                            </span>
                                        </button>
                                    </div>
                            </div>
                            </form>
                        </div>
                    </div>
                   
				</div>
			</div>
		</div>

        <script src="{% static 'js/messages.js' %}"></script>
        <script src="{% static 'js/functions.js' %}"></script>
       
		
	</body>
</html>
